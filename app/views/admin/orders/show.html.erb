<h1>注文履歴詳細</h1>

注文者
<%= @order.customer.last_name+@order.customer.first_name %> <br />

注文日
<%= @order.created_at.strftime('%Y/%m/%d') %> <br />

配送先
<%= @order.postal_code+@order.address+@order.name %> <br />

支払方法
<%= @order.payment_method_i18n %>  <br />

注文ステータス
<%= form_with model: @order, url: admin_order_path(@order.id), method: :patch  do |f| %>
 <%#= f.select :status, [['入金待ち',0], ['入金確認',1], ['製作中',2], [' 発送準備中',3], ['発送済み',4]] %>
 <%= f.select :status, Order.statuses.keys.map { |k| [I18n.t("enums.order.status.#{k}"), k] } %>
 <%= f.submit '更新' %>
<% end %>

<table class="table">
  <thead>
    <tr>
      <th>商品名</th>
      <th>単価(税込)</th>
      <th>数量</th>
      <th>小計</th>
      <th>製作ステータス</th>
    </tr>
  </thead>
  <tbody>
    <% @order_details.each do |order_detail| %>
      <tr>
        <td>
          <%= order_detail.item.name %>
        </td>
        <td>
          <%= order_detail.item.with_tax_price.to_s(:delimited) %>
        </td>
        <td>
          <%= order_detail.amount %>
        </td>
        <td>
          <%= (order_detail.item.with_tax_price * order_detail.amount).to_s(:delimited) %>
          <% @subtotal = @subtotal + (order_detail.item.with_tax_price * order_detail.amount) %>
        </td>
        <td>
          <%= form_with model: order_detail, url: admin_order_detail_path(order_detail.id), method: :patch do |f| %>
            <%#= f.select :making_status, [['製作不可',0], ['製作待ち',1], ['製作中',2], [' 製作完了',3]] %>
            <%= f.select :making_status, OrderDetail.making_statuses.keys.map { |k| [I18n.t("enums.order_detail.making_status.#{k}"), k] } %>
            <%= f.submit '更新' %>
          <% end %>
        </td>
       </tr>
    <% end %>
  </tbody>
</table>
商品合計
<%= @subtotal.to_s(:delimited) %>円 <br />
送料
800円 <br />
請求金額合計
<% @total = @subtotal+ 800 %>
<%= @total.to_s(:delimited) %>円
